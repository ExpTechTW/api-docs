---
title: "[Analysis] LB Server 請求分析"
description: "2025/12/13 上午 9:19:57 至 9:25:01 期間，LB Server 處理了 948,920 個請求，平均 RPS 3,121.45，峰值 RPS 3,183.02。系統穩定性極佳（零伺服器錯誤），但負載分布不均，lb-1 處理了 30.58% 的流量。"
date: 2025-12-14
slug: analysis-2025-12-14
image: /img/ExpTech_Studio_white.png
authors: [yuyu1015]
tags: [yuyu1015, analysis]
keywords: [Analysis, LB Server, 請求分析]
---

## 📊 分析概述

**分析時間範圍：** 2025/12/13 上午 9:19:57 至 9:25:01 (UTC+8)  
**持續時間：** 5 分鐘 4 秒  
**分析目的：** 評估負載平衡伺服器運作狀況與系統表現  
**分析重點：** 流量分布、伺服器負載、錯誤率、API 使用情況

{/* truncate */}

---

## 📈 總體統計

### 流量指標

- **總請求數：** 948,920
- **平均 RPS：** 3,121.45
- **峰值 RPS：** 3,183.02
- **總數據傳輸量：** 659.64 MB
- **平均請求大小：** 728.91 B
- **請求大小範圍：** 0 B ~ 94.12 KB

### HTTP 狀態碼統計

| 狀態碼類別           | 數量    | 比例   |
| -------------------- | ------- | ------ |
| **2xx (成功)**       | 921,963 | 97.16% |
| **3xx (重定向)**     | 1       | 0.00%  |
| **4xx (客戶端錯誤)** | 26,956  | 2.84%  |
| **5xx (伺服器錯誤)** | 0       | 0.00%  |

#### 詳細狀態碼分布

| 狀態碼 | 數量    | 比例   |
| ------ | ------- | ------ |
| 200    | 921,702 | 97.13% |
| 404    | 26,932  | 2.84%  |
| 204    | 261     | 0.03%  |
| 499    | 24      | 0.00%  |
| 302    | 1       | 0.00%  |

## 🔝 熱門請求端點

| 排名 | 請求                                      | 請求數 | 比例  | 累積比例 | RPS    |
| ---- | ----------------------------------------- | ------ | ----- | -------- | ------ |
| 1    | `GET /api/v2/eq/eew [lb-2.exptech.dev]`   | 88,110 | 9.29% | 9.29%    | 289.84 |
| 2    | `GET /api/v2/eq/eew [lb-1.exptech.dev]`   | 87,496 | 9.22% | 18.51%   | 287.82 |
| 3    | `GET /api/v2/eq/eew [lb-3.exptech.dev]`   | 87,108 | 9.18% | 27.69%   | 286.54 |
| 4    | `GET /api/v2/eq/eew [lb-4.exptech.dev]`   | 87,065 | 9.18% | 36.86%   | 286.40 |
| 5    | `GET /api/v2/trem/rts [lb-2.exptech.dev]` | 86,989 | 9.17% | 46.03%   | 286.15 |
| 6    | `GET /api/v2/trem/rts [lb-4.exptech.dev]` | 86,966 | 9.16% | 55.19%   | 286.07 |
| 7    | `GET /api/v2/trem/rts [lb-1.exptech.dev]` | 86,954 | 9.16% | 64.36%   | 286.03 |
| 8    | `GET /api/v2/trem/rts [lb-3.exptech.dev]` | 86,615 | 9.13% | 73.48%   | 284.92 |
| 9    | `GET /api/v1/trem/rts [lb-1.exptech.dev]` | 60,190 | 6.34% | 79.83%   | 197.99 |
| 10   | `GET /ntp [lb-1.exptech.dev]`             | 40,335 | 4.25% | 84.08%   | 132.68 |
| 11   | `GET /api/v1/trem/rts [lb-2.exptech.dev]` | 25,096 | 2.64% | 86.72%   | 82.55  |
| 12   | `GET /ntp [lb-2.exptech.dev]`             | 17,428 | 1.84% | 88.56%   | 57.33  |
| 13   | `GET /ntp [lb-3.exptech.dev]`             | 17,332 | 1.83% | 90.39%   | 57.01  |
| 14   | `GET /ntp [lb-4.exptech.dev]`             | 17,321 | 1.83% | 92.21%   | 56.98  |
| 15   | `GET /websocket [lb-4.exptech.dev]`       | 8,575  | 0.90% | 93.11%   | 28.21  |
| 16   | `GET /websocket [lb-3.exptech.dev]`       | 8,544  | 0.90% | 94.01%   | 28.11  |
| 17   | `GET /websocket [lb-1.exptech.dev]`       | 8,475  | 0.89% | 94.91%   | 27.88  |
| 18   | `GET /api/v1/eq/eew [lb-1.exptech.dev]`   | 6,633  | 0.70% | 95.61%   | 21.82  |
| 19   | `GET /api/v1/eq/eew [lb-3.exptech.dev]`   | 6,351  | 0.67% | 96.28%   | 20.89  |
| 20   | `GET /api/v1/eq/eew [lb-4.exptech.dev]`   | 6,346  | 0.67% | 96.94%   | 20.88  |
| 21   | `GET /api/v1/trem/rts [lb-3.exptech.dev]` | 6,305  | 0.66% | 97.61%   | 20.74  |
| 22   | `GET /api/v1/eq/eew [lb-2.exptech.dev]`   | 6,287  | 0.66% | 98.27%   | 20.68  |
| 23   | `GET /api/v1/trem/rts [lb-4.exptech.dev]` | 5,934  | 0.63% | 98.90%   | 19.52  |
| 24   | `GET /api/v1/trem/rts [lb.exptech.dev]`   | 5,750  | 0.61% | 99.50%   | 18.91  |
| 25   | `GET /websocket [lb-2.exptech.dev]`       | 769    | 0.08% | 99.58%   | 2.53   |
| 26   | `GET /ntp [lb.exptech.dev]`               | 365    | 0.04% | 99.62%   | 1.20   |
| 27   | `GET /api/v2/trem/rts [lb.exptech.dev]`   | 360    | 0.04% | 99.66%   | 1.18   |
| 28   | `GET /api/v1/eq/eew [lb.exptech.dev]`     | 360    | 0.04% | 99.70%   | 1.18   |

---

## 💻 客戶端平台統計

**共 14 個不同的平台**

| 排名 | 平台         | 請求數  | 比例   |
| ---- | ------------ | ------- | ------ |
| 1    | trem_lite    | 375,765 | 39.60% |
| 2    | Dart/Flutter | 264,753 | 27.90% |
| 3    | tremv        | 165,834 | 17.48% |
| 4    | ZeroQuake    | 72,434  | 7.63%  |
| 5    | Unknown      | 27,754  | 2.92%  |
| 6    | Node.js      | 25,429  | 2.68%  |
| 7    | Other        | 6,962   | 0.73%  |
| 8    | Chrome       | 3,948   | 0.42%  |
| 9    | Python       | 2,104   | 0.22%  |
| 10   | Axios        | 2,081   | 0.22%  |
| 11   | curl         | 1,080   | 0.11%  |
| 12   | dpip         | 585     | 0.06%  |
| 13   | Safari       | 183     | 0.02%  |
| 14   | Firefox      | 8       | 0.00%  |

---

## 🖥️ 負載平衡器統計

**共 5 個不同的 Host**

| 排名 | Host             | 請求數  | 比例   |
| ---- | ---------------- | ------- | ------ |
| 1    | lb-1.exptech.dev | 290,151 | 30.58% |
| 2    | lb-2.exptech.dev | 224,730 | 23.68% |
| 3    | lb-3.exptech.dev | 212,328 | 22.38% |
| 4    | lb-4.exptech.dev | 212,276 | 22.37% |
| 5    | lb.exptech.dev   | 8,886   | 0.94%  |

---

## 🔍 詳細分析

### 1. 系統流量表現

#### 流量規模

本次分析期間，系統成功處理了 **948,920 個 HTTP 請求**，平均每秒處理 **3,121.45 個請求**（RPS），峰值達到 **3,183.02 RPS**。此流量規模顯示系統具備良好的處理能力，能夠應付高流量負載。

#### ✅ 表現良好

- 系統能夠穩定處理高流量（平均 3,121 RPS）
- 峰值流量與平均流量差異小（僅 2%），顯示流量穩定
- 總數據傳輸量 659.64 MB，平均每個請求 729 bytes，屬於輕量級請求，傳輸效率良好

#### 請求分布特徵

流量高度集中於核心 API 端點，前 8 個最熱門的端點佔總流量的 **73.48%**，其中：

- `/api/v2/eq/eew`（地震預警）：36.87%
- `/api/v2/trem/rts`（即時測站）：36.63%

#### ✅ 表現良好

- 核心服務（地震預警和即時報告）流量分布均勻，在 4 個負載平衡器上各約 9%
- 流量集中於核心功能，符合預期的使用模式

### 2. 負載平衡器表現

#### 負載分布情況

| 伺服器 | 請求數  | 比例   | 與理想值差異 |
| ------ | ------- | ------ | ------------ |
| lb-1   | 290,151 | 30.58% | +5.58%       |
| lb-2   | 224,730 | 23.68% | -1.32%       |
| lb-3   | 212,328 | 22.38% | -2.62%       |
| lb-4   | 212,276 | 22.37% | -2.63%       |

#### ✅ 表現良好

- 4 台負載平衡器都在正常運作，沒有單點故障
- 負載分布相對均勻，差異在可接受範圍內（22-31%）
- 核心 API 端點在 4 台伺服器上分布均勻

#### ⚠️ 表現不佳

- `lb-1.exptech.dev` 處理了 **30.58%** 的流量，明顯高於其他伺服器（理想值應為 25%）
- 負載分布不均可能導致 `lb-1` 承受較大壓力
- 若 `lb-1` 發生故障，影響範圍較大（約 30% 的流量）

#### 通用域名使用情況

`lb.exptech.dev`（通用域名）僅處理 **0.94%** 的流量，表示大部分客戶端直接指定特定負載平衡器。此設計有助於故障隔離，提升系統可靠性。

### 3. API 端點使用情況

#### 核心 API 端點負載

| API 端點           | 總請求數 | 比例   | 平均 RPS |
| ------------------ | -------- | ------ | -------- |
| `/api/v2/eq/eew`   | 349,779  | 36.87% | ~1,150   |
| `/api/v2/trem/rts` | 347,524  | 36.63% | ~1,143   |
| `/api/v1/trem/rts` | 97,525   | 10.28% | ~321     |
| `/ntp`             | 92,440   | 9.75%  | ~304     |
| `/websocket`       | 34,363   | 3.62%  | ~113     |
| `/api/v1/eq/eew`   | 25,977   | 2.74%  | ~85      |

#### ✅ 表現良好

**地震預警 (`/api/v2/eq/eew`)**

- 系統核心功能，流量最高（36.87%）
- 在 4 個負載平衡器上分布均勻，運作穩定
- 平均 RPS 約 1,150，處理能力良好

**即時測站 (`/api/v2/trem/rts`)**

- 與地震預警 API 並列為核心服務（36.63%）
- 負載分布均勻，運作穩定
- 兩個核心 API 共同佔據 73.5% 的流量，顯示核心服務運作正常

**API 版本使用情況**

- v2 API 使用率達 73.5%，為主要使用版本
- 大部分用戶已遷移至 v2 API

#### ⚠️ 表現不佳

- v1 API 仍有 13.02% 的使用率，表示仍有部分用戶使用舊版 API
- 需要關注 v1 API 的維護成本和相容性問題

#### 其他服務表現

**NTP 時間同步服務**

- 流量佔比 9.75%，運作穩定
- 提供時間同步功能，使用率正常

**WebSocket 連接**

- 流量佔比 3.62%，連線數穩定
- 用於即時資料推送，運作正常

### 4. 客戶端平台分析

#### 主要客戶端平台分布

| 排名 | 平台         | 請求數  | 比例   |
| ---- | ------------ | ------- | ------ |
| 1    | trem_lite    | 375,765 | 39.60% |
| 2    | Dart/Flutter | 264,753 | 27.90% |
| 3    | tremv        | 165,834 | 17.48% |
| 4    | ZeroQuake    | 72,434  | 7.63%  |
| 5    | Unknown      | 27,754  | 2.92%  |
| 6    | Node.js      | 25,429  | 2.68%  |

#### ✅ 表現良好

**平台多樣性**

- 共支援 **14 個不同的平台**，顯示系統被廣泛採用
- 主要平台（trem_lite、Dart/Flutter、tremv）運作正常，共佔 84.98% 的流量

**主要平台表現**

- **trem_lite**（39.60%）：最大的單一客戶端平台，運作穩定
- **Dart/Flutter**（27.90%）：行動應用程式平台，使用率穩定
- **tremv**（17.48%）：第三大平台，運作正常

#### ⚠️ 表現不佳

- **Unknown 平台**（2.92%）：27,754 個請求無法識別平台來源
- 可能影響數據分析的準確性，無法針對特定平台進行優化

### 5. 系統健康狀況

#### 整體錯誤率分析

| 狀態碼類別        | 數量    | 比例   | 評估      |
| ----------------- | ------- | ------ | --------- |
| 2xx（成功）       | 921,963 | 97.16% | ✅ 優秀   |
| 3xx（重定向）     | 1       | 0.00%  | ✅ 正常   |
| 4xx（客戶端錯誤） | 26,956  | 2.84%  | ⚠️ 需改善 |
| 5xx（伺服器錯誤） | 0       | 0.00%  | ✅ 極佳   |

#### ✅ 表現良好

**零伺服器錯誤（5xx）**

- 系統穩定性極佳，後端服務運作正常
- 負載平衡器和後端伺服器未發生故障
- 顯示系統架構穩定可靠

**高成功率**

- 97.16% 的請求成功處理
- 符合高品質服務標準（> 95%）
- 系統整體運作品質優秀

**499 錯誤極低**

- 僅 24 個請求（0.00%）被客戶端取消
- 表示系統響應速度良好，用戶體驗佳

#### ⚠️ 表現不佳

**404 錯誤分析**

- **錯誤數量：** 26,932 個（2.84%）
- **錯誤率評估：** 略高於理想值（理想 < 2%）

**可能原因**

- 客戶端使用舊版 API 路徑或已變更的端點
- API 版本不匹配
- 客戶端配置錯誤（錯誤的端點路徑）
- 舊版客戶端仍在使用已棄用的端點

**影響**

- 影響用戶體驗，可能導致應用程式功能異常
- 需要用戶更新客戶端或修正配置

### 6. 系統效能表現

#### 請求大小分布

| 指標         | 數值         | 評估                |
| ------------ | ------------ | ------------------- |
| 平均請求大小 | 728.91 bytes | ✅ 輕量級，效能良好 |
| 最小請求大小 | 0 B          | 正常（健康檢查）    |
| 最大請求大小 | 94.12 KB     | 正常（WebSocket）   |

#### ✅ 表現良好

- 平均請求大小合理，屬於輕量級 API 請求
- 請求大小分布正常，無異常模式
- 系統能夠高效處理輕量級請求

#### 數據傳輸效率

| 指標             | 數值        | 評估                 |
| ---------------- | ----------- | -------------------- |
| 總傳輸量         | 659.64 MB   | 5 分鐘內傳輸量正常   |
| 平均傳輸速度     | 約 2.2 MB/s | 傳輸速度穩定         |
| 平均每個請求大小 | 729 bytes   | 輕量級請求，效率良好 |

#### ✅ 表現良好

- 數據傳輸效率良好，符合 RESTful API 的典型特徵
- 網路頻寬使用率在合理範圍內，無明顯瓶頸
- 傳輸速度穩定，系統運作順暢

---

## 📋 總結

### 系統整體表現評估

| 評估項目   | 狀態      | 說明                                |
| ---------- | --------- | ----------------------------------- |
| 系統穩定性 | ✅ 優秀   | 零伺服器錯誤，成功率高達 97.16%     |
| 負載平衡   | ⚠️ 需改善 | lb-1 負載過高（30.58% vs 理想 25%） |
| API 端點   | ✅ 良好   | 核心 API 運作正常，流量分布均勻     |
| 錯誤處理   | ⚠️ 需改善 | 404 錯誤率 2.84%，略高於理想值      |
| 平台支援   | ✅ 良好   | 支援 14 個平台，主要平台運作正常    |

### ✅ 表現優秀的部分

#### 1. 系統穩定性極佳

- 零伺服器錯誤（5xx），後端服務運作正常
- 97.16% 的請求成功處理，符合高品質服務標準
- 系統能夠穩定處理高流量（平均 3,121 RPS）

#### 2. 核心服務運作正常

- 地震預警 API 和即時測站 API 運作穩定
- 核心 API 在 4 個負載平衡器上分布均勻
- 流量集中於核心功能，符合預期使用模式

#### 3. 平台支援廣泛

- 支援 14 個不同的平台
- 主要平台（trem_lite、Dart/Flutter、tremv）運作正常

#### 4. 效能表現良好

- 請求處理效率高，平均請求大小合理
- 數據傳輸效率良好，網路頻寬使用率正常

### ⚠️ 需要改善的部分

#### 1. 負載平衡不均

- `lb-1` 處理了 30.58% 的流量，高於其他伺服器
- 可能導致 `lb-1` 承受較大壓力，影響整體效能

#### 2. 404 錯誤率偏高

- 2.84% 的 404 錯誤率略高於理想值（< 2%）
- 可能影響用戶體驗，需要關注客戶端配置和 API 版本使用情況

#### 3. v1 API 仍在使用

- 仍有 13.02% 的流量使用 v1 API
- 需要關注 API 版本遷移進度

#### 4. Unknown 平台識別

- 2.92% 的請求無法識別平台來源
- 可能影響數據分析的準確性
